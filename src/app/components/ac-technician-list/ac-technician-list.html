<div class="container py-5" dir="rtl">
  <!-- Header -->
  <div class="text-center mb-5">
    <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-info bg-opacity-10 p-4 mb-3">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" class="text-info">
        <path d="M6.59 3.41L2 8L3.41 9.41L6.59 6.23C7.97 4.86 10.03 4 12 4C14.76 4 17.07 5.81 17.76 8.26L19.86 7.83C18.92 4.5 15.76 2 12 2C9.34 2 6.95 3.16 5.34 5.02L3.41 3.09L2 4.5L6.59 9.09L11.17 4.5L9.76 3.09L6.59 3.41ZM17.41 20.59L22 16L20.59 14.59L17.41 17.77C16.03 19.14 13.97 20 12 20C9.24 20 6.93 18.19 6.24 15.74L4.14 16.17C5.08 19.5 8.24 22 12 22C14.66 22 17.05 20.84 18.66 18.98L20.59 20.91L22 19.5L17.41 14.91L12.83 19.5L14.24 20.91L17.41 20.59Z" fill="currentColor"/>
      </svg>
    </div>
    <h1 class="display-4 fw-bold text-info mb-3">فني تكييف - شحن وصيانة</h1>
    <p class="lead text-muted">اختر أفضل فني تكييف محترف لصيانة وتركيب المكيفات</p>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="d-flex justify-content-center align-items-center" style="min-height: 400px;" role="status">
      <div class="spinner-border text-info" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">جاري التحميل...</span>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-danger text-center" role="alert">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" class="text-danger mb-3">
        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="currentColor"/>
      </svg>
      <p class="mb-3">{{ error() }}</p>
      <button type="button" class="btn btn-info text-white" (click)="loadAcTechnicians()">
        إعادة المحاولة
      </button>
    </div>
  }

  <!-- Content -->
  @if (!loading() && !error()) {
    <!-- Search -->
    <div class="row mb-4">
      <div class="col-12 col-md-8 col-lg-6 mx-auto">
        <div class="input-group input-group-lg shadow-sm">
          <span class="input-group-text bg-white border-end-0">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="text-info">
              <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
            </svg>
          </span>
          <input
            type="search"
            class="form-control border-start-0"
            placeholder="ابحث عن فني تكييف..."
            [value]="searchQuery()"
            (input)="onSearch($event)"
            aria-label="البحث عن فني تكييف"
          />
        </div>
      </div>
    </div>

    <!-- AC Technicians Grid -->
    <div class="row g-4">
      @for (technician of filteredAcTechnicians(); track technician.id) {
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card h-100 border-0 shadow-sm hover-shadow">
            <!-- Card Image/Header -->
            <div class="position-relative" style="height: 200px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              @if (technician.imageUrl) {
                <img 
                  [src]="technician.imageUrl" 
                  [alt]="technician.name"
                  class="card-img-top h-100 w-100"
                  style="object-fit: cover;"
                  loading="lazy"
                />
              } @else {
                <div class="d-flex align-items-center justify-content-center h-100 text-white">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M6.59 3.41L2 8L3.41 9.41L6.59 6.23C7.97 4.86 10.03 4 12 4C14.76 4 17.07 5.81 17.76 8.26L19.86 7.83C18.92 4.5 15.76 2 12 2C9.34 2 6.95 3.16 5.34 5.02L3.41 3.09L2 4.5L6.59 9.09L11.17 4.5L9.76 3.09L6.59 3.41ZM17.41 20.59L22 16L20.59 14.59L17.41 17.77C16.03 19.14 13.97 20 12 20C9.24 20 6.93 18.19 6.24 15.74L4.14 16.17C5.08 19.5 8.24 22 12 22C14.66 22 17.05 20.84 18.66 18.98L20.59 20.91L22 19.5L17.41 14.91L12.83 19.5L14.24 20.91L17.41 20.59Z" fill="currentColor"/>
                  </svg>
                </div>
              }
              
              <!-- Badges -->
              <div class="position-absolute top-0 start-0 m-3 d-flex gap-2 flex-wrap">
                @if (technician.availability) {
                  <span class="badge bg-success shadow-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="ms-1" aria-hidden="true">
                      <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
                    </svg>
                    متاح
                  </span>
                } @else {
                  <span class="badge bg-secondary shadow-sm">غير متاح</span>
                }
                
                @if (technician.emergencyService) {
                  <span class="badge bg-danger shadow-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="ms-1" aria-hidden="true">
                      <path d="M12 2L1 21H23L12 2ZM13 18H11V16H13V18ZM13 14H11V10H13V14Z" fill="currentColor"/>
                    </svg>
                    طوارئ 24/7
                  </span>
                }
              </div>
            </div>

            <!-- Card Body -->
            <div class="card-body">
              <h5 class="card-title fw-bold mb-3 text-dark">{{ technician.name }}</h5>
              
              <div class="mb-3">
                <!-- Email -->
                <div class="d-flex align-items-start mb-2 small text-muted">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2 flex-shrink-0 mt-1" aria-hidden="true">
                    <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="currentColor"/>
                  </svg>
                  <span class="text-break">{{ technician.email }}</span>
                </div>

                <!-- Phone -->
                <div class="d-flex align-items-center mb-2 small text-muted">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2 flex-shrink-0" aria-hidden="true">
                    <path d="M6.62 10.79C8.06 13.62 10.38 15.94 13.21 17.38L15.41 15.18C15.69 14.9 16.08 14.82 16.43 14.93C17.55 15.3 18.75 15.5 20 15.5C20.55 15.5 21 15.95 21 16.5V20C21 20.55 20.55 21 20 21C10.61 21 3 13.39 3 4C3 3.45 3.45 3 4 3H7.5C8.05 3 8.5 3.45 8.5 4C8.5 5.25 8.7 6.45 9.07 7.57C9.18 7.92 9.1 8.31 8.82 8.59L6.62 10.79Z" fill="currentColor"/>
                  </svg>
                  <span>{{ technician.phone }}</span>
                </div>

                <!-- Address -->
                <div class="d-flex align-items-start mb-2 small text-muted">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2 flex-shrink-0 mt-1" aria-hidden="true">
                    <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="currentColor"/>
                  </svg>
                  <span>{{ technician.address }}</span>
                </div>

                <!-- Specialization -->
                <div class="d-flex align-items-center mb-2">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2 flex-shrink-0" aria-hidden="true">
                    <path d="M6.59 3.41L2 8L3.41 9.41L6.59 6.23C7.97 4.86 10.03 4 12 4C14.76 4 17.07 5.81 17.76 8.26L19.86 7.83C18.92 4.5 15.76 2 12 2C9.34 2 6.95 3.16 5.34 5.02L3.41 3.09L2 4.5L6.59 9.09L11.17 4.5L9.76 3.09L6.59 3.41Z" fill="currentColor"/>
                  </svg>
                  <span class="badge bg-info bg-opacity-10 text-info">{{ technician.specialization }}</span>
                </div>

                <!-- Experience -->
                <div class="d-flex align-items-center mb-3 small text-muted">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2 flex-shrink-0" aria-hidden="true">
                    <path d="M20 6H16V4C16 2.89 15.11 2 14 2H10C8.89 2 8 2.89 8 4V6H4C2.89 6 2.01 6.89 2.01 8L2 19C2 20.11 2.89 21 4 21H20C21.11 21 22 20.11 22 19V8C22 6.89 21.11 6 20 6ZM14 6H10V4H14V6Z" fill="currentColor"/>
                  </svg>
                  <span>{{ technician.experience }} سنوات خبرة</span>
                </div>

                <!-- Brands -->
                @if (technician.brands && technician.brands.length > 0) {
                  <div class="mb-3">
                    <div class="d-flex align-items-center mb-2 small fw-semibold text-dark">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2" aria-hidden="true">
                        <path d="M19.5 3.5L18 2L16.5 3.5L15 2L13.5 3.5L12 2L10.5 3.5L9 2L7.5 3.5L6 2L4.5 3.5L3 2V22L4.5 20.5L6 22L7.5 20.5L9 22L10.5 20.5L12 22L13.5 20.5L15 22L16.5 20.5L18 22L19.5 20.5L21 22V2L19.5 3.5ZM19 19.09H5V4.91H19V19.09ZM6 15H18V17H6V15ZM6 11H18V13H6V11ZM6 7H18V9H6V7Z" fill="currentColor"/>
                      </svg>
                      <span>الماركات المدعومة:</span>
                    </div>
                    <div class="d-flex flex-wrap gap-1">
                      @for (brand of technician.brands; track brand) {
                        <span class="badge bg-light text-dark border small fw-normal">{{ brand }}</span>
                      }
                    </div>
                  </div>
                }

                <!-- Services -->
                @if (technician.services && technician.services.length > 0) {
                  <div class="mb-3">
                    <div class="d-flex align-items-center mb-2 small fw-semibold text-dark">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="text-info ms-2" aria-hidden="true">
                        <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
                      </svg>
                      <span>الخدمات:</span>
                    </div>
                    <div class="d-flex flex-wrap gap-1">
                      @for (service of technician.services; track service) {
                        <span class="badge bg-info bg-opacity-10 text-info small">{{ service }}</span>
                      }
                    </div>
                  </div>
                }

                <!-- Rating -->
                <div class="d-flex align-items-center pt-2 border-top">
                  <div class="d-flex ms-2" [attr.aria-label]="'التقييم: ' + technician.rating + ' من 5'">
                    @for (star of [1,2,3,4,5]; track star) {
                      <svg 
                        width="18" 
                        height="18" 
                        viewBox="0 0 24 24" 
                        [class]="star <= technician.rating ? 'text-warning' : 'text-muted'"
                        aria-hidden="true"
                      >
                        <path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z" fill="currentColor"/>
                      </svg>
                    }
                  </div>
                  <span class="fw-bold text-dark">{{ technician.rating }}</span>
                  <span class="text-muted small me-auto">(من 5.0)</span>
                </div>
              </div>

              <!-- Card Actions -->
              <div class="card-footer bg-transparent border-top-0 pt-0">
                <div class="d-grid gap-2">
                  <button 
                    type="button"
                    class="btn btn-info text-white fw-semibold"
                    (click)="contactAcTechnician(technician)"
                    [attr.aria-label]="'تواصل مع ' + technician.name"
                  >
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="ms-2" aria-hidden="true">
                      <path d="M6.62 10.79C8.06 13.62 10.38 15.94 13.21 17.38L15.41 15.18C15.69 14.9 16.08 14.82 16.43 14.93C17.55 15.3 18.75 15.5 20 15.5C20.55 15.5 21 15.95 21 16.5V20C21 20.55 20.55 21 20 21C10.61 21 3 13.39 3 4C3 3.45 3.45 3 4 3H7.5C8.05 3 8.5 3.45 8.5 4C8.5 5.25 8.7 6.45 9.07 7.57C9.18 7.92 9.1 8.31 8.82 8.59L6.62 10.79Z" fill="currentColor"/>
                    </svg>
                    اتصل الآن
                  </button>
                  <a 
                    [routerLink]="['/ac-technician', technician.id]"
                    class="btn btn-outline-info fw-semibold"
                    [attr.aria-label]="'عرض تفاصيل ' + technician.name"
                  >
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="ms-2" aria-hidden="true">
                      <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5C17 19.5 21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12C15 10.34 13.66 9 12 9Z" fill="currentColor"/>
                    </svg>
                    عرض التفاصيل
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      } @empty {
        <div class="col-12">
          <div class="alert alert-info text-center py-5 border-0 shadow-sm">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" class="text-info mb-3">
              <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V11H13V17ZM13 9H11V7H13V9Z" fill="currentColor"/>
            </svg>
            <h5 class="mb-2">لا توجد نتائج</h5>
            <p class="text-muted mb-0">جرب البحث بكلمات مختلفة أو تحقق من الفلاتر</p>
          </div>
        </div>
      }
    </div>
  }
</div>